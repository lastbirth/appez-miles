<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ê°„ë³„ ì‚¬ìš©ì ë§ˆì¼ë¦¬ì§€ ì‹ ì²­ì„œ</title>
    <script src="//t1.daumcdn.net/mapjs/prod/postcode/v2/postcode.v2.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
        .form-section, .table-section { margin-bottom: 40px; border: 1px solid #ddd; padding: 20px; border-radius: 6px; }
        .form-group { margin-bottom: 15px; display: flex; align-items: center; }
        .form-group label { width: 150px; font-weight: bold; margin-right: 10px; text-align: right; }
        .form-group input[type="text"], .form-group select, .form-group input[type="date"] { flex-grow: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; max-width: 400px; }
        .required label::after { content: ' *'; color: red; } /* í•„ìˆ˜ í•­ëª© ê°•ì¡° */
        .address-input-group { display: flex; align-items: center; max-width: 400px; }
        .address-input-group input { flex-grow: 1; margin-right: 5px; }
        .address-input-group button { padding: 8px 12px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 4px; }
        .btn-group { margin-top: 20px; text-align: center; }
        .btn-group button { padding: 10px 20px; margin: 0 5px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-primary { background-color: #28a745; color: white; }
        .btn-secondary { background-color: #6c757d; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:hover { background-color: #f9f9f9; cursor: pointer; }
        .selected-row { background-color: #ffeeba; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“… ê¸°ê°„ë³„ ì‚¬ìš©ì ë§ˆì¼ë¦¬ì§€ ì‹ ì²­ ë° ê´€ë¦¬</h1>

    <div class="form-section">
        <h2>âœ… ë§ˆì¼ë¦¬ì§€ ì‹ ì²­/ìˆ˜ì •</h2>
        <form id="mileageForm">
            <div class="form-group required">
                <label for="companyName">ê³ ê°ì‚¬(í”„ë¡œì íŠ¸)ëª…</label>
                <input type="text" id="companyName" name="companyName" maxlength="100" required>
            </div>

            <div class="form-group required">
                <label for="tripType">êµ¬ë¶„</label>
                <select id="tripType" name="tripType" required>
                    <option value="ì™•ë³µ" selected>ì™•ë³µ</option>
                    <option value="í¸ë„">í¸ë„</option>
                </select>
            </div>

            <div class="form-group required">
                <label for="tripDate">ì¼ì</label>
                <input type="date" id="tripDate" name="tripDate" required>
            </div>

            <div class="form-group required">
                <label>ì¶œë°œì§€</label>
                <div>
                    <input type="radio" id="startOffice" name="startLocationType" value="ì‚¬ë¬´ì‹¤" checked onclick="selectLocation('start', 'ì‚¬ë¬´ì‹¤')">
                    <label for="startOffice">ì‚¬ë¬´ì‹¤ (ì„œìš¸ì‹œ ê°•ì„œêµ¬ ì–‘ì²œë¡œ 583)</label><br>
                    <input type="radio" id="startOther" name="startLocationType" value="ì§ì ‘ì…ë ¥" onclick="selectLocation('start', 'ì§ì ‘ì…ë ¥')">
                    <label for="startOther">ì§ì ‘ ì…ë ¥</label>

                    <div class="address-input-group" id="startAddressGroup" style="margin-top: 5px;">
                        <input type="text" id="startLocationDisplay" name="startLocationDisplay" placeholder="ì–‘ì²œë¡œ 583" readonly required>
                        <input type="hidden" id="startLocationFull" name="startLocationFull">
                        <button type="button" onclick="openAddressSearch('start')">ì£¼ì†Œ ê²€ìƒ‰</button>
                    </div>
                </div>
            </div>

            <div class="form-group required">
                <label for="endLocationDisplay">ëª©ì ì§€</label>
                <div class="address-input-group">
                    <input type="text" id="endLocationDisplay" name="endLocationDisplay" placeholder="ì˜ˆ: ì–‘ì²œë¡œ 583" readonly required>
                    <input type="hidden" id="endLocationFull" name="endLocationFull">
                    <button type="button" onclick="openAddressSearch('end')">ì£¼ì†Œ ê²€ìƒ‰</button>
                </div>
            </div>

            <div class="form-group">
                <label for="distance">ê±°ë¦¬(km)</label>
                <input type="text" id="distance" name="distance" value="ìë™ ê³„ì‚° ì˜ˆì •" readonly>
            </div>

            <div class="form-group">
                <label for="mileage">ë§ˆì¼ë¦¬ì§€(ì›)</label>
                <input type="text" id="mileage" name="mileage" value="ìë™ ê³„ì‚° ì˜ˆì •" readonly>
            </div>

            <div class="form-group required">
                <label for="transportation">êµí†µìˆ˜ë‹¨</label>
                <select id="transportation" name="transportation" onchange="toggleCompanionInput()" required>
                    <option value="ëŒ€ì¤‘êµí†µ">ëŒ€ì¤‘êµí†µ</option>
                    <option value="ê°œì¸ì°¨ëŸ‰">ê°œì¸ì°¨ëŸ‰</option>
                </select>
            </div>

            <div class="form-group" id="companionGroup" style="display: none;">
                <label for="companion">ë™ìŠ¹ì</label>
                <input type="text" id="companion" name="companion" placeholder="ë™ìŠ¹ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì½¤ë§ˆë¡œ êµ¬ë¶„)">
            </div>

            <div class="form-group required">
                <label for="purpose">ë°©ë¬¸ëª©ì </label>
                <select id="purpose" name="purpose" onchange="toggleOtherPurposeInput()" required>
                    <option value="ì •ê¸°ì ê²€">ì •ê¸°ì ê²€</option>
                    <option value="íšŒì˜">íšŒì˜</option>
                    <option value="ì¥ì• ì²˜ë¦¬">ì¥ì• ì²˜ë¦¬</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€ (ì§ì ‘ ì…ë ¥)</option>
                </select>
            </div>
            <div class="form-group" id="otherPurposeGroup" style="display: none;">
                <label></label> <input type="text" id="otherPurpose" name="otherPurpose" placeholder="ë°©ë¬¸ëª©ì ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”" style="max-width: 400px;">
            </div>

            <div class="form-group">
                <label for="status">ì²˜ë¦¬ê²°ê³¼</label>
                <input type="text" id="status" name="status" value="ëŒ€ê¸°" readonly>
                <input type="hidden" id="mileageId" name="mileageId"> </div>

            <div class="btn-group">
                <button type="submit" class="btn-primary">ì‹ ì²­</button>
                <button type="button" class="btn-secondary" onclick="resetForm()">ì·¨ì†Œ/ì´ˆê¸°í™”</button>
            </div>
        </form>
    </div>

    <div class="table-section">
        <h2>ğŸ“‹ ë§ˆì¼ë¦¬ì§€ ì‹ ì²­ ë‚´ì—­ ì¡°íšŒ</h2>
        <div class="btn-group" style="text-align: right;">
            <button type="button" class="btn-secondary" onclick="loadData()">ì¡°íšŒ</button>
            <button type="button" class="btn-secondary" onclick="editSelected()">ìˆ˜ì •</button>
            <button type="button" class="btn-danger" onclick="deleteSelected()">ì‚­ì œ</button>
        </div>
        
        <table id="mileageTable">
            <thead>
                <tr>
                    <th>ì„ íƒ</th>
                    <th>ê³ ê°ì‚¬ëª…</th>
                    <th>êµ¬ë¶„</th>
                    <th>ì¼ì</th>
                    <th>ì¶œë°œì§€</th>
                    <th>ëª©ì ì§€</th>
                    <th>ê±°ë¦¬(km)</th>
                    <th>ë§ˆì¼ë¦¬ì§€(ì›)</th>
                    <th>êµí†µìˆ˜ë‹¨</th>
                    <th>ë™ìŠ¹ì</th>
                    <th>ë°©ë¬¸ëª©ì </th>
                    <th>ì²˜ë¦¬ê²°ê³¼</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>
</div>

<script>
    // ë”ë¯¸ ë°ì´í„° ë°°ì—´ (ì‹¤ì œë¡œëŠ” ì„œë²„/êµ¬ê¸€ì‹œíŠ¸ì—ì„œ ê°€ì ¸ì˜´)
    let mileageData = [];
    let currentId = 1; // ID ìƒì„±ì„ ìœ„í•œ ì¹´ìš´í„°

    // ì‚¬ë¬´ì‹¤ ì£¼ì†Œ ìƒìˆ˜
    const OFFICE_FULL_ADDRESS = 'ì„œìš¸ì‹œ ê°•ì„œêµ¬ ì–‘ì²œë¡œ 583';
    const OFFICE_DISPLAY_ADDRESS = 'ì–‘ì²œë¡œ 583';

    // ì´ˆê¸° ë¡œë“œ ì‹œ ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', (event) => {
        // 'ì™•ë³µ'ì´ ê¸°ë³¸ ì„ íƒë˜ë„ë¡ ì´ë¯¸ HTMLì—ì„œ ì„¤ì •ë¨
        // 'ì‚¬ë¬´ì‹¤'ì´ ê¸°ë³¸ ì„ íƒë˜ë„ë¡ ì´ë¯¸ HTMLì—ì„œ ì„¤ì •ë¨
        
        // ì¶œë°œì§€ ê¸°ë³¸ê°’ ì„¤ì • (ì‚¬ë¬´ì‹¤)
        document.getElementById('startLocationDisplay').value = OFFICE_DISPLAY_ADDRESS;
        document.getElementById('startLocationFull').value = OFFICE_FULL_ADDRESS;
        document.getElementById('startAddressGroup').style.display = 'none'; // ì‚¬ë¬´ì‹¤ ì„ íƒ ì‹œ ì£¼ì†Œ ê²€ìƒ‰ ìˆ¨ê¹€

        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        loadData();
    });

    /**
     * Daum ì£¼ì†Œ íŒì—…ì„ ì—½ë‹ˆë‹¤.
     * @param {string} type 'start' ë˜ëŠ” 'end'
     */
    function openAddressSearch(type) {
        new daum.Postcode({
            oncomplete: function(data) {
                let roadAddr = data.roadAddress; // ë„ë¡œëª… ì£¼ì†Œ ë³€ìˆ˜
                let fullAddr = data.userSelectedType === 'R' ? data.roadAddress : data.jibunAddress; // ì „ì²´ ì£¼ì†Œ (ë„ë¡œëª… ë˜ëŠ” ì§€ë²ˆ)

                // í™”ë©´ì— í‘œì‹œí•  ë„ë¡œëª… ì¶”ì¶œ (ì˜ˆ: ì–‘ì²œë¡œ 583)
                // ë„ë¡œëª… ì£¼ì†Œì—ì„œ 'ì‹œ/ë„', 'ì‹œ/êµ°/êµ¬'ë¥¼ ì œì™¸í•œ ë¶€ë¶„ë§Œ í‘œì‹œ
                let roadNameOnly = roadAddr.substring(roadAddr.indexOf(data.sigungu) + data.sigungu.length).trim();
                
                // ë¶ˆí•„ìš”í•œ ê³µë°±ê³¼ íŠ¹ìˆ˜ë¬¸ì ì œê±° í›„ í•„ìš”í•œ ë¶€ë¶„ë§Œ ë‚¨ê¸°ê¸°
                // ê°„ë‹¨í•˜ê²ŒëŠ” ê·¸ëƒ¥ roadAddr ì „ì²´ë¥¼ ì‚¬ìš©í•˜ê³ , ì‚¬ìš©ìê°€ ì…ë ¥í•˜ëŠ” ë¶€ë¶„(ê±´ë¬¼ë²ˆí˜¸ ë“±)ë§Œ ë‚¨ê¸°ë„ë¡ ë³µì¡í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ,
                // ì—¬ê¸°ì„œëŠ” ìš”ì²­í•˜ì‹  'ë„ë¡œëª…ë§Œ í‘œì‹œ'ì— ê°€ê¹ê²Œ êµ¬í˜„í•˜ê¸° ìœ„í•´ ê±´ë¬¼ëª…/ë²ˆí˜¸ ë“±ì„ í¬í•¨í•œ ìµœì¢… ë„ë¡œëª… ì£¼ì†Œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
                
                // ì—¬ê¸°ì„œëŠ” ì‹¬í”Œí•˜ê²Œ ë„ë¡œëª… ì£¼ì†Œ ì „ì²´(ex: ì„œìš¸ ê°•ì„œêµ¬ ì–‘ì²œë¡œ 583)ë¥¼ ì‚¬ìš©í•˜ê³ ,
                // ì‚¬ìš©ìì—ê²ŒëŠ” ì£¼ìš” ë„ë¡œëª…ê³¼ ê±´ë¬¼ ë²ˆí˜¸ë§Œ ë³´ì´ë„ë¡ ì²˜ë¦¬í•©ë‹ˆë‹¤.
                const addressParts = roadAddr.split(' ');
                // ë³´í†µ ë„ë¡œëª… + ê±´ë¬¼ë²ˆí˜¸ (ex: ì–‘ì²œë¡œ 583)ë§Œ í‘œì‹œ
                const displayAddress = addressParts.slice(addressParts.length - 2).join(' ');
                
                if (type === 'start') {
                    document.getElementById('startLocationDisplay').value = displayAddress;
                    document.getElementById('startLocationFull').value = fullAddr;
                } else {
                    document.getElementById('endLocationDisplay').value = displayAddress;
                    document.getElementById('endLocationFull').value = fullAddr;
                }
            }
        }).open();
    }

    /**
     * ì¶œë°œì§€ ë¼ë””ì˜¤ ë²„íŠ¼ ì„ íƒì— ë”°ë¼ ì…ë ¥ ë°©ì‹ì„ ë³€ê²½í•©ë‹ˆë‹¤.
     * @param {string} type 'start'
     * @param {string} value 'ì‚¬ë¬´ì‹¤' ë˜ëŠ” 'ì§ì ‘ì…ë ¥'
     */
    function selectLocation(type, value) {
        const displayInput = document.getElementById(type + 'LocationDisplay');
        const fullInput = document.getElementById(type + 'LocationFull');
        const addressGroup = document.getElementById(type + 'AddressGroup');
        
        if (value === 'ì‚¬ë¬´ì‹¤') {
            displayInput.value = OFFICE_DISPLAY_ADDRESS;
            fullInput.value = OFFICE_FULL_ADDRESS;
            addressGroup.style.display = 'none';
        } else {
            displayInput.value = '';
            fullInput.value = '';
            addressGroup.style.display = 'flex'; // ì£¼ì†Œ ê²€ìƒ‰ ë²„íŠ¼ í‘œì‹œ
        }
    }

    /**
     * êµí†µìˆ˜ë‹¨ ì„ íƒì— ë”°ë¼ ë™ìŠ¹ì ì…ë ¥ í•„ë“œë¥¼ í† ê¸€í•©ë‹ˆë‹¤.
     */
    function toggleCompanionInput() {
        const transportation = document.getElementById('transportation').value;
        const companionGroup = document.getElementById('companionGroup');
        const companionInput = document.getElementById('companion');

        if (transportation === 'ê°œì¸ì°¨ëŸ‰') {
            companionGroup.style.display = 'flex';
            companionInput.required = true; // ê°œì¸ì°¨ëŸ‰ì¼ ë•Œ ë™ìŠ¹ì í•„ë“œë¥¼ í•„ìˆ˜ í•­ëª©ìœ¼ë¡œ ê°„ì£¼ (ì„ íƒì  ì…ë ¥ì€ ê°€ëŠ¥í•˜ë‚˜, ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ê°œì¸ì°¨ëŸ‰ ì‹œ ì…ë ¥ì´ í™œì„±í™”ë¨)
        } else {
            companionGroup.style.display = 'none';
            companionInput.required = false;
            companionInput.value = ''; // ëŒ€ì¤‘êµí†µ ì„ íƒ ì‹œ ê°’ ì´ˆê¸°í™”
        }
    }
    
    /**
     * ë°©ë¬¸ëª©ì  ì„ íƒì— ë”°ë¼ ê¸°íƒ€ ì…ë ¥ í•„ë“œë¥¼ í† ê¸€í•©ë‹ˆë‹¤.
     */
    function toggleOtherPurposeInput() {
        const purpose = document.getElementById('purpose').value;
        const otherPurposeGroup = document.getElementById('otherPurposeGroup');
        const otherPurposeInput = document.getElementById('otherPurpose');

        if (purpose === 'ê¸°íƒ€') {
            otherPurposeGroup.style.display = 'flex';
            otherPurposeInput.required = true;
        } else {
            otherPurposeGroup.style.display = 'none';
            otherPurposeInput.required = false;
            otherPurposeInput.value = '';
        }
    }

    // í¼ ì œì¶œ ì²˜ë¦¬ (ì‹ ì²­ ê¸°ëŠ¥)
    document.getElementById('mileageForm').addEventListener('submit', function(e) {
        e.preventDefault();

        // **í•„ìˆ˜ í•­ëª© ê²€ì‚¬ (ë¸Œë¼ìš°ì € ê¸°ë³¸ ê²€ì‚¬ë¥¼ ì‚¬ìš©í•˜ë˜ ì¶”ê°€ ë¡œì§ í™•ì¸)**
        
        // ë™ìŠ¹ì í•„ë“œ ì¡°ê±´ë¶€ í•„ìˆ˜ ê²€ì‚¬
        const transportation = document.getElementById('transportation').value;
        const companionInput = document.getElementById('companion');
        if (transportation === 'ê°œì¸ì°¨ëŸ‰' && companionInput.value.trim() === '') {
            alert('êµí†µìˆ˜ë‹¨ì´ ê°œì¸ì°¨ëŸ‰ì¼ ê²½ìš° ë™ìŠ¹ìë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
            companionInput.focus();
            return;
        }

        // ë°©ë¬¸ëª©ì  'ê¸°íƒ€'ì¼ ë•Œ ì§ì ‘ì…ë ¥ ê²€ì‚¬
        const purpose = document.getElementById('purpose').value;
        const otherPurposeInput = document.getElementById('otherPurpose');
        if (purpose === 'ê¸°íƒ€' && otherPurposeInput.value.trim() === '') {
            alert('ë°©ë¬¸ëª©ì  (ê¸°íƒ€) ë‚´ìš©ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
            otherPurposeInput.focus();
            return;
        }

        // í¼ ë°ì´í„° ìˆ˜ì§‘
        const formData = {
            companyName: document.getElementById('companyName').value,
            tripType: document.getElementById('tripType').value,
            tripDate: document.getElementById('tripDate').value,
            // í™”ë©´ í‘œì‹œìš© ì£¼ì†Œ (ë„ë¡œëª…)
            startLocationDisplay: document.getElementById('startLocationDisplay').value,
            endLocationDisplay: document.getElementById('endLocationDisplay').value,
            // ìˆ¨ê²¨ì§„ ì „ì²´ ì£¼ì†Œ (ë„¤ì´ë²„ ì§€ë„ API ì—°ë™ ì‹œ ì‚¬ìš©)
            startLocationFull: document.getElementById('startLocationFull').value,
            endLocationFull: document.getElementById('endLocationFull').value,
            
            distance: document.getElementById('distance').value,
            mileage: document.getElementById('mileage').value,
            transportation: transportation,
            companion: transportation === 'ê°œì¸ì°¨ëŸ‰' ? companionInput.value : '',
            purpose: purpose === 'ê¸°íƒ€' ? otherPurposeInput.value : purpose, // ë°©ë¬¸ëª©ì  ê°’ ì²˜ë¦¬
            status: document.getElementById('status').value,
        };
        
        const id = document.getElementById('mileageId').value;

        if (id) {
            // ìˆ˜ì • ê¸°ëŠ¥
            const index = mileageData.findIndex(item => item.id == id);
            if (index !== -1) {
                mileageData[index] = { ...formData, id: parseInt(id) };
                alert('ë§ˆì¼ë¦¬ì§€ ì‹ ì²­ ë‚´ì—­ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        } else {
            // ì‹ ì²­ ê¸°ëŠ¥ (ìƒˆ ë°ì´í„° ì¶”ê°€)
            const newData = { ...formData, id: currentId++ };
            mileageData.push(newData);
            alert('ë§ˆì¼ë¦¬ì§€ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        resetForm();
        loadData(); // í…Œì´ë¸” ì—…ë°ì´íŠ¸
    });

    /**
     * í¼ì˜ ëª¨ë“  í•„ë“œë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
     */
    function resetForm() {
        document.getElementById('mileageForm').reset();
        document.getElementById('mileageId').value = '';
        document.getElementById('status').value = 'ëŒ€ê¸°'; // ì²˜ë¦¬ê²°ê³¼ ì´ˆê¸°ê°’
        
        // ì¶œë°œì§€ ê¸°ë³¸ê°’ ì¬ì„¤ì • (ì‚¬ë¬´ì‹¤)
        document.getElementById('startLocationDisplay').value = OFFICE_DISPLAY_ADDRESS;
        document.getElementById('startLocationFull').value = OFFICE_FULL_ADDRESS;
        document.getElementById('startOffice').checked = true;
        document.getElementById('startAddressGroup').style.display = 'none';

        // ì¡°ê±´ë¶€ í•„ë“œ ìˆ¨ê¹€
        document.getElementById('companionGroup').style.display = 'none';
        document.getElementById('otherPurposeGroup').style.display = 'none';
        
        // í…Œì´ë¸” ì„ íƒ í•´ì œ
        const selectedRow = document.querySelector('.selected-row');
        if (selectedRow) {
            selectedRow.classList.remove('selected-row');
        }
    }

    /**
     * ë°ì´í„° ë°°ì—´ì„ í…Œì´ë¸”ì— í‘œì‹œí•©ë‹ˆë‹¤ (ì¡°íšŒ ê¸°ëŠ¥).
     */
    function loadData() {
        const tableBody = document.getElementById('mileageTable').querySelector('tbody');
        tableBody.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

        mileageData.forEach(item => {
            const row = tableBody.insertRow();
            row.setAttribute('data-id', item.id);
            row.onclick = function() { selectRow(this); };

            // ì²´í¬ë°•ìŠ¤ (ì„ íƒ)
            const selectCell = row.insertCell();
            selectCell.innerHTML = `<input type="radio" name="selectMileage" value="${item.id}">`;

            // ë°ì´í„° ì…€ ì¶”ê°€
            row.insertCell().textContent = item.companyName;
            row.insertCell().textContent = item.tripType;
            row.insertCell().textContent = item.tripDate;
            row.insertCell().textContent = item.startLocationDisplay;
            row.insertCell().textContent = item.endLocationDisplay;
            row.insertCell().textContent = item.distance;
            row.insertCell().textContent = item.mileage;
            row.insertCell().textContent = item.transportation;
            row.insertCell().textContent = item.companion;
            row.insertCell().textContent = item.purpose;
            row.insertCell().textContent = item.status;
        });
    }

    let selectedRowId = null;

    /**
     * í…Œì´ë¸” í–‰ ì„ íƒ ì‹œ ìŠ¤íƒ€ì¼ì„ ì ìš©í•˜ê³  IDë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
     */
    function selectRow(row) {
        const radio = row.querySelector('input[type="radio"]');
        if (radio) {
            radio.checked = true;
            selectedRowId = row.getAttribute('data-id');

            // ê¸°ì¡´ ì„ íƒëœ í–‰ ìŠ¤íƒ€ì¼ ì œê±°
            document.querySelectorAll('#mileageTable tbody tr').forEach(r => {
                r.classList.remove('selected-row');
            });
            // ìƒˆë¡­ê²Œ ì„ íƒëœ í–‰ì— ìŠ¤íƒ€ì¼ ì ìš©
            row.classList.add('selected-row');
        }
    }

    /**
     * ì„ íƒëœ ë°ì´í„°ë¥¼ í¼ì— ë¡œë“œí•˜ì—¬ ìˆ˜ì • ì¤€ë¹„ë¥¼ í•©ë‹ˆë‹¤ (ìˆ˜ì • ê¸°ëŠ¥).
     */
    function editSelected() {
        if (!selectedRowId) {
            alert('ìˆ˜ì •í•  ë§ˆì¼ë¦¬ì§€ ë‚´ì—­ì„ í…Œì´ë¸”ì—ì„œ ì„ íƒí•´ ì£¼ì„¸ìš”.');
            return;
        }

        const dataToEdit = mileageData.find(item => item.id == selectedRowId);
        if (!dataToEdit) return;

        // í¼ í•„ë“œì— ê°’ ì±„ìš°ê¸°
        document.getElementById('mileageId').value = dataToEdit.id;
        document.getElementById('companyName').value = dataToEdit.companyName;
        document.getElementById('tripType').value = dataToEdit.tripType;
        document.getElementById('tripDate').value = dataToEdit.tripDate;
        
        // ì¶œë°œì§€ ê°’ ì„¤ì •
        const isOffice = dataToEdit.startLocationFull === OFFICE_FULL_ADDRESS;
        document.getElementById(isOffice ? 'startOffice' : 'startOther').checked = true;
        selectLocation('start', isOffice ? 'ì‚¬ë¬´ì‹¤' : 'ì§ì ‘ì…ë ¥'); // ì£¼ì†Œ ê·¸ë£¹ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
        document.getElementById('startLocationDisplay').value = dataToEdit.startLocationDisplay;
        document.getElementById('startLocationFull').value = dataToEdit.startLocationFull;
        
        // ëª©ì ì§€ ê°’ ì„¤ì •
        document.getElementById('endLocationDisplay').value = dataToEdit.endLocationDisplay;
        document.getElementById('endLocationFull').value = dataToEdit.endLocationFull;
        
        document.getElementById('transportation').value = dataToEdit.transportation;
        toggleCompanionInput(); // ë™ìŠ¹ì í•„ë“œ í† ê¸€
        document.getElementById('companion').value = dataToEdit.companion;
        
        // ë°©ë¬¸ëª©ì  ê°’ ì„¤ì •
        const purposeSelect = document.getElementById('purpose');
        if (['ì •ê¸°ì ê²€', 'íšŒì˜', 'ì¥ì• ì²˜ë¦¬'].includes(dataToEdit.purpose)) {
            purposeSelect.value = dataToEdit.purpose;
            toggleOtherPurposeInput(); // 'ê¸°íƒ€' í•„ë“œ ìˆ¨ê¹€
        } else {
            // 'ê¸°íƒ€'ë¡œ ê°„ì£¼í•˜ê³  ì§ì ‘ ì…ë ¥ í•„ë“œì— ê°’ ì±„ìš°ê¸°
            purposeSelect.value = 'ê¸°íƒ€';
            toggleOtherPurposeInput(); // 'ê¸°íƒ€' í•„ë“œ í‘œì‹œ
            document.getElementById('otherPurpose').value = dataToEdit.purpose;
        }
        
        document.getElementById('status').value = dataToEdit.status;

        // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½ (ì„ íƒ ì‚¬í•­)
        document.querySelector('.btn-primary').textContent = 'ìˆ˜ì • ì™„ë£Œ';
        
        // í¼ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
        document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
    }

    /**
     * ì„ íƒëœ ë°ì´í„°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤ (ì‚­ì œ ê¸°ëŠ¥).
     */
    function deleteSelected() {
        if (!selectedRowId) {
            alert('ì‚­ì œí•  ë§ˆì¼ë¦¬ì§€ ë‚´ì—­ì„ í…Œì´ë¸”ì—ì„œ ì„ íƒí•´ ì£¼ì„¸ìš”.');
            return;
        }

        if (confirm('ì„ íƒëœ ë§ˆì¼ë¦¬ì§€ ì‹ ì²­ ë‚´ì—­ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            mileageData = mileageData.filter(item => item.id != selectedRowId);
            selectedRowId = null;
            resetForm(); // í¼ ì´ˆê¸°í™” ë° ì„ íƒ í•´ì œ
            loadData(); // í…Œì´ë¸” ì—…ë°ì´íŠ¸
            alert('ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
    }
</script>

</body>
</html>
